<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Deploying a Jekyll site to GitHub Pages with Rake</title>
  <meta name="description" content="Deploying to GitHub pages  was more complicated than I expected. This was because the jekyll theme used plugins that github pages did not support, so the sit...">

  <!--icons-->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
  <link rel="manifest" href="/assets/img/site.webmanifest">
  <link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="/assets/img/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: [
      "MathMenu.js",
      "MathZoom.js",
      "AssistiveMML.js",
      "a11y/accessibility-menu.js"
    ],
    jax: ["input/TeX", "output/CommonHTML"],
    TeX: {
      extensions: [
        "AMSmath.js",
        "AMSsymbols.js",
        "noErrors.js",
        "noUndefined.js",
      ]
    }
  });
</script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

 <!--   <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
  

  <link rel="stylesheet" type="text/css" href="/css/tufte.css">
  <!-- <link rel="stylesheet" type="text/css" href="/css/print.css" media="print"> -->

  <link rel="canonical" href="/articles/21/Deploying-to-github-pages-with-Rake">

  <link rel="alternate" type="application/rss+xml" title="Open Sourcerers' Guild" href="/feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
    <nav class="group">
	<a href="/"><img class="badge" src="/assets/img/logo_1.png" alt="OSG"></a>
	
		
  	
		
		    
		      <a href="/">The Chronicle</a>
		    
	    
  	
		
		    
		      <a href="/about/">About</a>
		    
	    
  	
		
		    
		      <a href="/css/print.css"></a>
		    
	    
  	
		
  	
	</nav>
</header>

    <article class="group">
      <h1>Deploying a Jekyll site to GitHub Pages with Rake</h1>
<p class="subtitle">December 11, 2021</p>

<p><span class="newthought">Deploying to GitHub pages</span>  was more complicated than I expected. This was because the jekyll theme used plugins that github pages did not support, so the site had to be deployed by using the static _site folder generated by jekyll <!--more-->when the <code class="language-plaintext highlighter-rouge">jekyll build</code> command is used instead of just pushing the whole project and letting github build it.</p>

<h2 id="how-it-works">How it works</h2>
<p>A Rakefile contains the publish function (can be run via <code class="language-plaintext highlighter-rouge">rake publish</code> on the terminal) which, generates the site; moves the content of _site into a temp directory; checks out a branch called gh-pages; removes all the content in gh-pages; moves the contents of the temp directory into gh-pages; commits and pushes gh-pages; checks out main; prints yolo;
If you use a custom domain for your gh-pages site, you need to have the CNAME file on the main branch and the publish function will move the CNAME file into the temp directory as well ensuring the CNAME file is reput in gh-pages after its contents are deleted. Here is the Rakefile:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'rake'</span>
<span class="nb">require</span> <span class="s1">'rdoc'</span>
<span class="nb">require</span> <span class="s1">'date'</span>
<span class="nb">require</span> <span class="s1">'yaml'</span>
<span class="nb">require</span> <span class="s1">'tmpdir'</span>
<span class="nb">require</span> <span class="s1">'jekyll'</span>

<span class="n">desc</span> <span class="s2">"Generate blog files"</span>
<span class="n">task</span> <span class="ss">:generate</span> <span class="k">do</span>
  <span class="no">Jekyll</span><span class="o">::</span><span class="no">Site</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Jekyll</span><span class="p">.</span><span class="nf">configuration</span><span class="p">({</span>
    <span class="s2">"source"</span>      <span class="o">=&gt;</span> <span class="s2">"."</span><span class="p">,</span>
    <span class="s2">"destination"</span> <span class="o">=&gt;</span> <span class="s2">"_site"</span>
  <span class="p">})).</span><span class="nf">process</span>
<span class="k">end</span>


<span class="n">desc</span> <span class="s2">"Generate and publish blog to gh-pages"</span>
<span class="n">task</span> <span class="ss">:publish</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="ss">:generate</span><span class="p">]</span> <span class="k">do</span>
  <span class="no">Dir</span><span class="p">.</span><span class="nf">mktmpdir</span> <span class="k">do</span> <span class="o">|</span><span class="n">tmp</span><span class="o">|</span>
    <span class="nb">system</span> <span class="s2">"mv _site/* </span><span class="si">#{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">"</span>
    <span class="c1"># uncomment if you have a CNAME file</span>
    <span class="c1"># system "mv CNAME #{tmp}"</span>
    <span class="nb">system</span> <span class="s2">"git checkout -B gh-pages"</span>
    <span class="nb">system</span> <span class="s2">"rm -rf *"</span>
    <span class="nb">system</span> <span class="s2">"mv </span><span class="si">#{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">/* ."</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">"Site updated at </span><span class="si">#{</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">utc</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">system</span> <span class="s2">"git add ."</span>
    <span class="nb">system</span> <span class="s2">"git commit -am </span><span class="si">#{</span><span class="n">message</span><span class="p">.</span><span class="nf">shellescape</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">system</span> <span class="s2">"git push origin gh-pages --force"</span>
    <span class="nb">system</span> <span class="s2">"git checkout main"</span>
    <span class="nb">system</span> <span class="s2">"echo yolo"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="ss">:publish</span>
</code></pre></div></div>
<p>It should be placed at the highest level in your jekyll projects’ directory.</p>

<h2 id="github-pages-settings">GitHub Pages settings</h2>
<p>After running the above script by typing <code class="language-plaintext highlighter-rouge">rake publish</code> on the terminal, your GitHub Pages setting also need to be configured. Go to your repository, navigate to Settings &gt; Pages. Under the Source section you will be able to set which branch the site is gets built from, set that to be gh-pages.</p>

<h2 id="using-with-a-custom-domain">Using with a custom domain</h2>
<p>You can set-up a custom domain for your site by following the instructions outlined by GitHub in their <a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site">GitHub Pages documentation</a>. After you set a custom domain a CNAME file will be generated for the gh-pages branch, you need to copy that file into the main branch(in the same place where the Rakefile is). In the Rakefile uncomment <code class="language-plaintext highlighter-rouge">system "mv CNAME #{tmp}"</code>, by deleting the hashtag and space at the start of the line. This line copies the CNAME file into gh-pages when publish is used. There might be other ways to have the CNAME file in gh-pages but this is the method I use.</p>

<p>The original Rakefile comes from the <a href="https://github.com/clayh53/tufte-jekyll">tufte-jekyll</a> repository, I modified it to account for the CNAME file and also work with “main” instead of “master”.</p>
<div class="post-author">Jason Carvalho</div>



    </article>
    <span class="print-footer">Deploying a Jekyll site to GitHub Pages with Rake - December 11, 2021 - Open Sourcerers Guild</span>
    <footer>
  <hr class="slender">
  <ul class="footer-links">
    <li><a href="mailto:hate@spam.net"><span class="icon-mail3"></span></a></li>    
    
      <li>
        <a href=""><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href=""><span class="icon-github"></span></a>
      </li>
    
      <li>
        <a href=""><span class="icon-flickr3"></span></a>
      </li>
    
      <li>
        <a href=""><span class="icon-rss2"></span></a>
      </li>
    
      <li>
        <a href=""><span class="icon-vimeo2"></span></a>
      </li>
    
      <li>
        <a href=""><span class="icon-linkedin"></span></a>
      </li>
      
  </ul>
<div class="credits">
<span>&copy; 2022 &nbsp;&nbsp;OPEN SOURCERERS GUILD</span></br> <br>
<!--span>This site created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme for Content-centric blogging </a> in <a href="//jekyllrb.com">Jekyll</a>.</span-->
</div>  
</footer>

  </body>
</html>
